# yamllint disable rule:line-length
rule_files:
  - prometheus_alerts.yaml

tests:
  - interval: 1m
    input_series:
      - series: 'karpenter_cloudprovider_errors_total{namespace="karpenter", job="karpenter", provider="aws", controller="node.termination", method="Get"}'
        values: "1+1x20"
    alert_rule_test:
      - eval_time: 20m
        alertname: KarpenterCloudProviderErrors
        exp_alerts:
          - exp_labels:
              namespace: karpenter
              job: karpenter
              provider: aws
              controller: node.termination
              method: Get
              severity: warning
            exp_annotations:
              summary: "Karpenter has Cloud Provider Errors."
              description: "The Karpenter provider aws with the controller node.termination has errors with the method Get."
              dashboard_url: "https://grafana.com/d/kubernetes-autoscaling-mixin-kperf-jkwq/kubernetes-autoscaling-karpenter-performance"
